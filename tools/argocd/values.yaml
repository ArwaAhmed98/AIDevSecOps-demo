argo-cd:
  global:
    image:
      repository: docker.io/argoproj/argocd
      tag: v3.1.8
    securityContext:
      runAsUser: 10001
      runAsGroup: 10001
      fsGroup: 10001

  configs:
    secret:
      # If secret already exists externally (e.g., OAuth or repo creds), keep disabled
      createSecret: true
      repoSecretName: private-repo-secret

    rbac:
      policy.csv: |
        # Dynamic group mapping (example for GitHub teams)
        g, VFCOM-CICD:{{.group}}, role:{{.group}}

        # Admins
        g, VFCOM-CICD:DevOps, role:admin
        p, role:admin, applications, *, */*, allow
        p, role:admin, applicationsets, *, */*, allow
        p, role:admin, clusters, get, *, allow
        p, role:admin, repositories, *, *, allow
        p, role:admin, appprojects, *, *, allow

        # Readonly Org Users
        g, VFCOM-CICD:org, role:readonly
        p, role:readonly, applications, get, *, allow
        p, role:readonly, applications, list, *, allow

        # ApplicationSet Controller permissions
        p, system:serviceaccount:argocd:argocd-applicationset-controller, applications, *, */*, allow
        p, system:serviceaccount:argocd:argocd-applicationset-controller, applicationsets, *, */*, allow
        p, system:serviceaccount:argocd:argocd-applicationset-controller, appprojects, *, */*, allow

    cm:
      create: true
      url: "http://localhost:8085/argocd"
      timeout.reconciliation: 60s
      admin.enabled: true
      ui.bannercontent: |
        Welcome to DEMO Argo CD!  ðŸš€ 
        - Please log in with your GitHub Account 
        Managed by R&D Team ðŸŒŸ
      dex.config: |
        connectors:
          - type: github
            id: VFCOM-CICD
            name: ðŸ”’  VFCOM-CICD GitHub 
            config:
              hostName: github.vodafone.com
              clientID: $CLIENT_ID
              clientSecret: $CLIENT_SECRET
              orgs:
              - name: VFCOM-CICD
                teams: []
              loadAllGroups: true

    repositoryCredentials:
      - url: https://github.vodafone.com/VFCOM-CICD/
        usernameSecret:
          name: argocd-repo-creds
          key: username
        passwordSecret:
          name: argocd-repo-creds
          key: password

    repositories:
      - url: https://github.vodafone.com/VFCOM-CICD/AIDevSecOps-demo
        type: git

    params:
      controller.status.processors: "20"
      controller.operation.processors: "10"
      controller.repo.server.timeout.seconds: "60"
      controller.self.heal.timeout.seconds: "60"
      controller.app.resync.period.seconds: "600"
      applicationsetcontroller.enable.leader.election: "false"
      applicationsetcontroller.policy: sync
      server.insecure: "true"
      applicationsetcontroller.log.format: json
      applicationsetcontroller.log.level: info

  controller:
    enableStatefulSet: true
    replicas: 1
    env:
      - name: HOME
        value: /home/argocd
    containerSecurityContext:
      capabilities:
        drop: [ "ALL" ]
      readOnlyRootFilesystem: true
      runAsNonRoot: true
      allowPrivilegeEscalation: false
    resources:
      limits:
        cpu: 3500m
        memory: 4608Mi
      requests:
        cpu: 100m
        memory: 380Mi

  applicationSet:
    replicaCount: 1

  repoServer:
    containerSecurityContext:
      capabilities:
        drop: [ "ALL" ]
      readOnlyRootFilesystem: true
      runAsNonRoot: true
      allowPrivilegeEscalation: false
    resources:
      limits:
        cpu: 650m
        memory: 400Mi
      requests:
        cpu: 100m
        memory: 128Mi

  server:
    extraArgs:
      - --basehref=/argocd
      - --rootpath=/argocd
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 5
      targetCPUUtilizationPercentage: 80
      targetMemoryUtilizationPercentage: 90
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
        interval: 30s
      service:
        portName: http-metrics
    serviceAccount:
      create: true
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 50m
        memory: 64Mi

  notifications:
    enabled: false

  redis:
    containerSecurityContext:
      capabilities:
        drop: [ "ALL" ]
      readOnlyRootFilesystem: true
      runAsNonRoot: true
      allowPrivilegeEscalation: false
    securityContext:
      runAsNonRoot: true
      runAsUser: 10001
    resources:
      limits:
        cpu: 100m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 64Mi

  dex:
    env:
      - name: CLIENT_ID
        valueFrom:
          secretKeyRef:
            name: argocd-oauth-secret
            key: CLIENT_ID
      - name: CLIENT_SECRET
        valueFrom:
          secretKeyRef:
            name: argocd-oauth-secret
            key: CLIENT_SECRET
